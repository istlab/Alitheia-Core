<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- 
/*
 * Copyright (c) Members of the SQO-OSS Collaboration, 2007
 * All rights reserved by respective owners.
 * See http://www.sqo-oss.eu/ for details on the copyright holders.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the SQO-OSS project nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
 * FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE
 * REGENTS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 */
-->
<project name="mvcs" default="compile">
    <property name="sqooss.build.dir" value="build" />
    <property name="sqooss.lib.dir" value="lib" />
    <property name="sqooss.src.dir" value="src" />
	<property name="sqooss.doc.dir" value="docs" />
    <property name="sqooss.dist.dir" value="dist" />

    <path id="libraries">
		<fileset dir="lib">
		    <include name="**/*.jar"/>
		</fileset>
    </path>
	
	<target name="javadoc" description="Create javadoc for the SQO-OSS prototype">
        <javadoc packagenames="eu.sqooss"
                 sourcepath="${sqooss.src.dir}"
                 destdir="${sqooss.doc.dir}"
                 nohelp="true"
                 notree="true"
                 nodeprecated="true"
                 nodeprecatedlist="true"
                 author="false"
                 version="true"
                 windowtitle="SQO-OSS API Documentation"
                 doctitle="SQO-OSS prototype API"
                 bottom="Copyright (c) Members of the SQO-OSS Collaboration, 2007">
        	<fileset dir="${sqooss.src.dir}" excludes="**/RCS/** Manifest **/**.xml **/**.properties" />
		</javadoc>
	</target>

    <target name="compile" description="Compile SQO-OSS prototype">
		<mkdir dir="${sqooss.build.dir}" />
		<mkdir dir="${sqooss.dist.dir}" />
		<javac destdir="${sqooss.build.dir}" srcdir="${sqooss.src.dir}"
		       source="1.5"
		       target="1.5">
		    <classpath>
				<path refid="libraries"/>
		    </classpath>
		</javac>
		<copy todir="${sqooss.build.dir}" flatten="true">
		    <fileset dir="${sqooss.src.dir}">
			<include name="**/*.xml" />
		    </fileset>
		    <fileset dir="${sqooss.src.dir}">
			<include name="**/*.properties" />
		    </fileset>
		</copy>
		<jar destfile="${sqooss.dist.dir}/sqo-oss.jar" basedir="${sqooss.build.dir}" manifest="src/MANIFEST"/>
    </target>

    <target name="clean">
		<delete dir="${sqooss.build.dir}" />
		<delete file="${sqooss.dist.dir}/sqo-oss.jar" />
		<delete dir="${sqooss.dist.dir}" />
    	<delete dir="${sqooss.doc.dir}" />
    </target>

    <taskdef name="hibernatetool"
	         classname="org.hibernate.tool.ant.HibernateToolTask"
	         classpathref="libraries">
    </taskdef>

    <target name="schemaexport" depends="compile">
		<hibernatetool destdir="${sqooss.build.dir}">
	    	<classpath>
				<pathelement path="${sqooss.dist.dir}/sqo-oss.jar"/>
				<path refid="libraries"/>
	    	</classpath>
	    	<configuration configurationfile="${sqooss.src.dir}/hibernate.cfg.xml"/>
		    <hbm2ddl drop="true"
		    		 create="true"
					 export="true"
					 outputfilename="schema-export.sql"
					 delimiter=";"
					 format="true"
		    />
		</hibernatetool>
    </target>
    
    <target name="test">
		<java fork="true" classname="eu.sqooss.test.StoredProjectTest" classpathref="libraries">
	    	<classpath>
				<pathelement path="${sqooss.dist.dir}/sqo-oss.jar"/>
				<path refid="libraries"/>
	    	</classpath>
	    	<arg value="${action}"/>
		</java>
    </target>
    
</project>
